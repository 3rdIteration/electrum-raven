sudo: true
dist: xenial
language: python
python:
- 3.6
- 3.7
git:
  depth: false
addons:
  apt:
    sources:
    - sourceline: ppa:tah83/secp256k1
    packages:
    - libsecp256k1-0
before_install:
- git tag
install:
- pip install -r contrib/requirements/requirements-travis.txt
cache:
- pip: true
- directories:
  - "/tmp/electrum-rvn-build"
script:
- echo "tests skipped"
after_success:
- if [ "$TRAVIS_BRANCH" = "master" ]; then pip install requests && contrib/make_locale;
  fi
- coveralls
jobs:
  include:
  - stage: binary builds
    sudo: true
    language: c
    python: false
    env:
    - TARGET_OS=Windows
    services:
    - docker
    install:
    - sudo docker build  --no-cache -t electrum-rvn-wine-builder-img ./contrib/build-wine/docker/
    script:
    - sudo docker run --name electrum-rvn-wine-builder-cont -v $PWD:/opt/wine64/drive_c/electrum-rvn
      --rm --workdir /opt/wine64/drive_c/electrum-rvn/contrib/build-wine electrum-rvn-wine-builder-img
      ./build.sh
    after_success: true
  - os: osx
    language: c
    env:
    - TARGET_OS=macOS
    python: false
    install:
    - git fetch --all --tags
    script: "./contrib/build-osx/make_osx"
    after_script: ls -lah dist && sha256sum dist/*
    after_success: true
deploy:
  provider: releases
  api_key:
    secure: J0YGFhpiy5fbX5opDEo8ZS7l5ssOXJlLcSIYZ2g6USUETikvvUXpaZo7g2nVbwjbl1FWkKbhUVxZQ4cMXomootCEVf8Bd3FEDsZErLMzPZ8HRUuLxP9xLqRzYqfcLy7vyoY7cJoLN/Suzir9mtjYpCBPou0psA0FHXfyuFMWETUntAl+vRz5hR6irpPEmwXkhYm5nv0GhMcOUoNtyJU1iLoQ3qxFi6cm13XUjeAM11Ol3qj4K3e/Vxcm/iNWnxySp8kC1Ssp8oLWR6GWPuGB9ZVmJ50ehqFDF4S+KML1OqnrpjlK9cjQQnb8yVDUHmvJqLc9CP57YH4Bk+FZJfUHtDD3xJwiwG2fbc7jL2A4zXD0gusPclvYmN3vlvoVbBlWjHAFTlWIoydwdOQWWNZecvd7AaIYyQqo5KEQx5FMpI982alhQurMVDxQk8FMAo32y1J+Rob+dk+3XJidSK0FtyR3g0p7ImFvGICddebKtLvaTCyffZrcPQByvQn557TSTRUKpe6oTSWbDFDK1AURJkudlCB3aTSY+Ld58gO0zlamsdUjVL1pgMdV4JSt1QrTDZ/F17dVwep0Ctv/7J+/lNMU2ZGx8Q/NnoFwku1DcKv1TmqTmKK6Haq9ForsZQuuWnKilgopVe1T1mFTmNcegs42foBma9ZZu6uWzWBWrIc=
  file_glob: true
  file: 
    - contrib/build-wine/dist/*.exe
    - dist/*.dmg
    - dist/*.tar.gz
    - dist/*.zip
  skip_cleanup: true
  draft: false
  on:
    tags: true
    repo: standard-error/electrum-raven
after_deploy: ls -al contrib/build-wine/dist/
